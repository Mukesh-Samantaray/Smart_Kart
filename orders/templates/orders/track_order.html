{% extends 'accounts/home.html' %}
{% block content %}
{% load static %}
<div class="container mt-4">
    <h3>Track Order #{{ order.id }}</h3>
    <p>Status: <strong id="orderStatus">{{ order.status }}</strong></p>
    <p>Placed on: {{ order.created_at }}</p>
    <p>Last updated: {{ order.updated_at }}</p>

    <div class="mt-4">
        <h5>Order Timeline</h5>
        <ul class="list-group mb-3">
            <li class="list-group-item">
                <strong>Order Placed:</strong>
                <span id="placedDate"></span>
            </li>
            <li class="list-group-item">
                <strong>Shipped:</strong>
                <span id="shippedDate"></span>
            </li>
            <li class="list-group-item">
                <strong>Expected Delivery:</strong>
                <span id="deliveryDate"></span>
            </li>
        </ul>
    </div>

    <h4>Items</h4>
    <ul class="list-group">
        {% for item in order.items.all %}
        <li class="list-group-item d-flex align-items-center">
            {% if item.product.image_url %}
                <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}" style="width:50px; height:50px; object-fit:cover; margin-right:12px;">
            {% else %}
                <img src="{% static 'accounts/images/default.png' %}" alt="No image" style="width:50px; height:50px; object-fit:cover; margin-right:12px;">
            {% endif %}
            <span>{{ item.product.name }} x {{ item.quantity }}</span>
        </li>
        {% endfor %}
    </ul>

    <a href="{% url 'orders:order_detail' order.id %}" class="btn btn-primary mt-3">Back to Details</a>
</div>

<script>
function randomDate(baseDate, minDays, maxDays) {
    const date = new Date(baseDate);
    const daysToAdd = Math.floor(Math.random() * (maxDays - minDays + 1)) + minDays;
    date.setDate(date.getDate() + daysToAdd);
    return date.toLocaleDateString();
}

window.onload = function() {
    // Get order placed date from Django context
    const placedDate = new Date("{{ order.created_at|date:'Y-m-d H:i:s' }}");
    document.getElementById('placedDate').textContent = placedDate.toLocaleDateString();

    // Shipped: 1-3 days after placed
    const shippedDateStr = randomDate(placedDate, 1, 3);
    document.getElementById('shippedDate').textContent = shippedDateStr;

    // Delivery: 2-5 days after shipped
    const shippedDate = new Date(shippedDateStr);
    const deliveryDateStr = randomDate(shippedDate, 2, 5);
    document.getElementById('deliveryDate').textContent = deliveryDateStr;
};
</script>
{% endblock %}